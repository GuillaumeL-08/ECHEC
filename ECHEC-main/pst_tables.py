from chess import PAWN, KNIGHT, BISHOP, ROOK, QUEEN, KING, WHITE, Board
import random as _rng

PIECE_VALUES = {PAWN: 100, KNIGHT: 320, BISHOP: 330, ROOK: 500, QUEEN: 900, KING: 20000}

PST = {
    PAWN: [
         0,  0,  0,  0,  0,  0,  0,  0,
        -5, -5, -5, -5, -5, -5, -5, -5,
        -3,  0,  2,  5,  5,  2,  0, -3,
         0,  3,  8, 15, 15,  8,  3,  0,
         5,  8, 12, 20, 20, 12,  8,  5,
        15, 20, 28, 35, 35, 28, 20, 15,
        40, 45, 50, 50, 50, 50, 45, 40,
         0,  0,  0,  0,  0,  0,  0,  0,
    ],
    KNIGHT: [
        -80,-60,-40,-40,-40,-40,-60,-80,
        -60,-30,  0,  5,  5,  0,-30,-60,
        -55,  0, 15, 22, 22, 15,  0,-55,
        -55,  5, 22, 30, 30, 22,  5,-55,
        -55,  5, 22, 30, 30, 22,  5,-55,
        -55,  0, 15, 22, 22, 15,  0,-55,
        -60,-30,  0,  0,  0,  0,-30,-60,
        -80,-60,-40,-40,-40,-40,-60,-80,
    ],
    BISHOP: [
        -20,-10,-10,-10,-10,-10,-10,-20,
        -10,  8,  0,  0,  0,  0,  8,-10,
        -10, 12, 12, 12, 12, 12, 12,-10,
        -10,  0, 12, 14, 14, 12,  0,-10,
        -10,  5,  8, 14, 14,  8,  5,-10,
        -10,  0,  8, 10, 10,  8,  0,-10,
        -10,  0,  0,  0,  0,  0,  0,-10,
        -20,-10,-10,-10,-10,-10,-10,-20,
    ],
    ROOK: [
         0,  0,  0,  2,  2,  0,  0,  0,
        -5,  0,  0,  0,  0,  0,  0, -5,
        -5,  0,  0,  0,  0,  0,  0, -5,
        -5,  0,  0,  0,  0,  0,  0, -5,
        -5,  0,  0,  0,  0,  0,  0, -5,
        -3,  0,  0,  0,  0,  0,  0, -3,
        10, 15, 15, 15, 15, 15, 15, 10,
         5,  5,  8, 10, 10,  8,  5,  5,
    ],
    QUEEN: [
        -20,-10,-10, -5, -5,-10,-10,-20,
        -10,  0,  0,  0,  0,  0,  0,-10,
        -10,  0,  5,  5,  5,  5,  0,-10,
         -5,  0,  5,  8,  8,  5,  0, -5,
         -5,  0,  5,  8,  8,  5,  0, -5,
        -10,  0,  5,  5,  5,  5,  0,-10,
        -10,  0,  0,  0,  0,  0,  0,-10,
        -20,-10,-10, -5, -5,-10,-10,-20,
    ],
    KING: [
         20, 30, 10,  0,  0, 10, 30, 20,
         20, 20,  0,  0,  0,  0, 20, 20,
        -10,-20,-20,-20,-20,-20,-20,-10,
        -20,-30,-30,-40,-40,-30,-30,-20,
        -30,-40,-40,-50,-50,-40,-40,-30,
        -30,-40,-40,-50,-50,-40,-40,-30,
        -30,-40,-40,-50,-50,-40,-40,-30,
        -30,-40,-40,-50,-50,-40,-40,-30,
    ],
}

QUEEN_ENDGAME = [
    -10, -5, -5, -5, -5, -5, -5,-10,
     -5,  0,  5,  5,  5,  5,  0, -5,
     -5,  5, 10, 10, 10, 10,  5, -5,
     -5,  5, 10, 15, 15, 10,  5, -5,
     -5,  5, 10, 15, 15, 10,  5, -5,
     -5,  5, 10, 10, 10, 10,  5, -5,
     -5,  0,  5,  5,  5,  5,  0, -5,
    -10, -5, -5, -5, -5, -5, -5,-10,
]

ROOK_ENDGAME = [
     0,  0,  5,  8,  8,  5,  0,  0,
     0,  5,  8, 10, 10,  8,  5,  0,
     0,  5,  8, 10, 10,  8,  5,  0,
     0,  5,  8, 10, 10,  8,  5,  0,
     0,  5,  8, 10, 10,  8,  5,  0,
     0,  5,  8, 10, 10,  8,  5,  0,
    10, 15, 15, 15, 15, 15, 15, 10,
     5,  8, 10, 12, 12, 10,  8,  5,
]

PAWN_ENDGAME = [
     0,  0,  0,  0,  0,  0,  0,  0,
     5,  5,  5,  5,  5,  5,  5,  5,
     8,  8, 10, 12, 12, 10,  8,  8,
    12, 14, 16, 20, 20, 16, 14, 12,
    20, 22, 25, 28, 28, 25, 22, 20,
    30, 33, 36, 40, 40, 36, 33, 30,
    45, 48, 50, 52, 52, 50, 48, 45,
     0,  0,  0,  0,  0,  0,  0,  0,
]

KING_ENDGAME = [
    -50,-40,-30,-20,-20,-30,-40,-50,
    -30,-20,-10,  0,  0,-10,-20,-30,
    -30,-10, 20, 30, 30, 20,-10,-30,
    -30,-10, 30, 40, 40, 30,-10,-30,
    -30,-10, 30, 40, 40, 30,-10,-30,
    -30,-10, 20, 30, 30, 20,-10,-30,
    -30,-30,  0,  0,  0,  0,-30,-30,
    -50,-30,-30,-30,-30,-30,-30,-50,
]

PST_BLACK = {pt: list(reversed(table)) for pt, table in PST.items()}
PST_BLACK[KING] = list(reversed(PST[KING]))

QUEEN_ENDGAME_BLACK  = list(reversed(QUEEN_ENDGAME))
ROOK_ENDGAME_BLACK   = list(reversed(ROOK_ENDGAME))
PAWN_ENDGAME_BLACK   = list(reversed(PAWN_ENDGAME))
KING_ENDGAME_BLACK   = list(reversed(KING_ENDGAME))

_rng.seed(0xDEADBEEF)

_ZOBRIST_PIECE = {}
for _color in (True, False):
    for _pt in (PAWN, KNIGHT, BISHOP, ROOK, QUEEN, KING):
        for _sq in range(64):
            _ZOBRIST_PIECE[(_color, _pt, _sq)] = _rng.getrandbits(64)

_ZOBRIST_TURN = _rng.getrandbits(64)
_ZOBRIST_CASTLING = [_rng.getrandbits(64) for _ in range(16)]
_ZOBRIST_EP = [_rng.getrandbits(64) for _ in range(8)]


def zobrist_hash(board: Board) -> int:
    h = 0
    for sq in range(64):
        piece = board.piece_at(sq)
        if piece:
            h ^= _ZOBRIST_PIECE[(piece.color, piece.piece_type, sq)]
    if board.turn == WHITE:
        h ^= _ZOBRIST_TURN
    h ^= _ZOBRIST_CASTLING[board.castling_rights & 0xF]
    if board.ep_square is not None:
        h ^= _ZOBRIST_EP[board.ep_square % 8]
    return h